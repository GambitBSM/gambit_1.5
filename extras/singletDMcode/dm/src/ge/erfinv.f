! NSWC function erfinv

      function erfinv (p, q)
!
!*******************************************************************************
!
!! ERFINV: evaluation of the inverse error function
!
!     for 0 <= p <= 1,  w = erfinv(p,q) where erf(w) = p. it is
!     assumed that q = 1 - p. if either inequality on p is violated
!     or p + q /= 1, then erfinv(p,q) is set to a negative value.
!
!
!     reference. mathematics of computation,oct.1976,pp.827-830.
!                  j.m.blair,c.a.edwards,j.h.johnson
!
        implicit none

        real*8 a(6),b(6),a1(7),b1(7),a2(9),b2(8),a3(9),b3(6)
        real*8 c,c1,c2,v,v1,s,t,p,q,eps
        real*8 erfinv
!
!     c2 = ln(1.d-100)
!
      data c /.5625/, c1 /.87890625/
      data c2 /-.2302585092994046d+03/
!
!                            table no.16
!
      data a(1)/.1400216916161353d+03/,  a(2)/-.7204275515686407d+03/, 
     &     a(3)/.1296708621660511d+04/,  a(4)/-.9697932901514031d+03/, 
     &     a(5)/.2762427049269425d+03/,  a(6)/-.2012940180552054d+02/
      data b(1)/.1291046303114685d+03/,  b(2)/-.7312308064260973d+03/, 
     &     b(3)/.1494970492915789d+04/,  b(4)/-.1337793793683419d+04/, 
     &     b(5)/.5033747142783567d+03/,  b(6)/-.6220205554529216d+02/
!
!                            table no.36
!
      data a1(1)/-.1690478046781745d+00/, a1(2)/.3524374318100228d+01/,
     &     a1(3)/-.2698143370550352d+02/, a1(4)/.9340783041018743d+02/,
     &     a1(5)/-.1455364428646732d+03/, a1(6)/.8805852004723659d+02/,
     &     a1(7)/-.1349018591231947d+02/
      data b1(1)/-.1203221171313429d+00/, b1(2)/.2684812231556632d+01/,
     &     b1(3)/-.2242485268704865d+02/, b1(4)/.8723495028643494d+02/,
     &     b1(5)/-.1604352408444319d+03/, b1(6)/.1259117982101525d+03/,
     &     b1(7)/-.3184861786248824d+02/
!
!                            table no.56
!
      data a2(1)/.3100808562552958d-04/, a2(2)/.4097487603011940d-02/, 
     &     a2(3)/.1214902662897276d+00/, a2(4)/.1109167694639028d+01/, 
     &     a2(5)/.3228379855663924d+01/, a2(6)/.2881691815651599d+01/, 
     &     a2(7)/.2047972087262996d+01/, a2(8)/.8545922081972148d+00/, 
     &     a2(9)/.3551095884622383d-02/
      data b2(1)/.3100809298564522d-04/, b2(2)/.4097528678663915d-02/, 
     &     b2(3)/.1215907800748757d+00/, b2(4)/.1118627167631696d+01/, 
     &     b2(5)/.3432363984305290d+01/, b2(6)/.4140284677116202d+01/, 
     &     b2(7)/.4119797271272204d+01/, b2(8)/.2162961962641435d+01/
!
!                            table no.79
!
      data a3(1)/.3205405422062050d-08/, a3(2)/.1899479322632128d-05/, 
     &     a3(3)/.2814223189858532d-03/, a3(4)/.1370504879067817d-01/, 
     &     a3(5)/.2268143542005976d+00/, a3(6)/.1098421959892340d+01/, 
     &     a3(7)/.6791143397056208d+00/, a3(8)/-.834334189167721d+00/, 
     &     a3(9)/.3421951267240343d+00/
      data b3(1)/.3205405053282398d-08/, b3(2)/.1899480592260143d-05/, 
     &     b3(3)/.2814349691098940d-03/, b3(4)/.1371092249602266d-01/, 
     &     b3(5)/.2275172815174473d+00/, b3(6)/.1125348514036959d+01/
!
        if (p < 0.0 .or. q  <  0.0) go to 100
        eps = max ( epsilon ( eps ),1.0d-15)
        t = 0.5 + (0.5 - (p + q))
        if (abs(t) > 2.0*eps) go to 100
        if (q == 0.0) go to 50
!
!                      0 <= p <= 0.75
!
        if (p > 0.75) go to 10
        v = p*p - c
        t = p *  (((((a(6)*v + a(5))*v + a(4))*v + a(3))*v 
     &                       + a(2))*v + a(1))
        s = (((((v + b(6))*v + b(5))*v + b(4))*v + b(3))*v 
     &                       + b(2))*v + b(1)
        go to 40
!
!                    0.75 < p <= 0.9375
!
10      if (p > 0.9375) go to 20
        v = p*p - c1
        t = p *  ((((((a1(7)*v + a1(6))*v + a1(5))*v + a1(4))*v 
     &                         + a1(3))*v + a1(2))*v + a1(1))
        s = ((((((v + b1(7))*v + b1(6))*v + b1(5))*v + b1(4))*v 
     &              + b1(3))*v + b1(2))*v + b1(1)
        go to 40
!
!                  1.d-100 <= q < 0.0625
!
20      v1 = log(q)
        v = 1.0/sqrt(-v1)
        if (v1 < c2) go to 30
        t = (((((((a2(9)*v + a2(8))*v + a2(7))*v + a2(6))*v + a2(5))*v 
     &                     + a2(4))*v + a2(3))*v + a2(2))*v + a2(1)
        s = v *  ((((((((v + b2(8))*v + b2(7))*v + b2(6))*v + b2(5))*v 
     &                     + b2(4))*v + b2(3))*v + b2(2))*v + b2(1))
        go to 40
!
!                 1.d-10000 <= q < 1.d-100
!
30      t = (((((((a3(9)*v + a3(8))*v + a3(7))*v + a3(6))*v +  
     &               a3(5))*v + a3(4))*v + a3(3))*v + a3(2))*v + a3(1)
        s = v * ((((((v + b3(6))*v + b3(5))*v + b3(4))*v + b3(3))*v 
     &                  + b3(2))*v + b3(1))
40      erfinv = t/s
        return
!
!                    0 <= q < 1.d-10000
!
50      erfinv = huge ( erfinv )
        return
!
!                         error return
!
100     erfinv = - huge ( erfinv )
        return
      end

